# RunningHub å¯¹æ¥éƒ¨ç½²æ­¥éª¤

## ä¸€ã€å‰ç½®å‡†å¤‡

### 1. è·å– RunningHub API Key

1. ç™»å½• https://www.runninghub.cn
2. ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ ã€ŒAPI æ§åˆ¶å°ã€
3. å¤åˆ¶ 32 ä½ API KEY
4. **æ³¨æ„**ï¼šéœ€è¦åŸºç¡€ç‰ˆåŠä»¥ä¸Šä¼šå‘˜æ‰èƒ½ä½¿ç”¨ API

### 2. é…ç½®å·¥ä½œæµ

1. åœ¨ RunningHub æ‰“å¼€ç›®æ ‡å·¥ä½œæµ
2. è®°å½•åœ°å€æ ä¸­çš„ workflow IDï¼ˆå¦‚ï¼š`1850925505116598274`ï¼‰
3. **é‡è¦**ï¼šç¡®ä¿å·¥ä½œæµå·²æ‰‹åŠ¨è¿è¡ŒæˆåŠŸè¿‡ï¼Œå¦åˆ™ API è°ƒç”¨ä¼šæŠ¥é”™
4. è®°å½•å›¾ç‰‡è¾“å…¥èŠ‚ç‚¹çš„ nodeId å’Œ fieldName

## äºŒã€é…ç½®ç¯å¢ƒå˜é‡

### æ–¹æ³•ä¸€ï¼šåœ¨ cloudbaserc.json ä¸­é…ç½®ï¼ˆæ¨èï¼‰

ç¼–è¾‘ `cloud-functions/cloudbaserc.json`ï¼Œæ‰¾åˆ° `upload` å’Œ `taskCheck` å‡½æ•°çš„ `envVariables`ï¼Œå°†ï¼š

```json
"RUNNINGHUB_API_KEY": "YOUR_RUNNINGHUB_API_KEY"
```

æ›¿æ¢ä¸ºæ‚¨çš„å®é™… API Keyã€‚

**æ³¨æ„**ï¼šä¿®æ”¹åéœ€è¦é‡æ–°éƒ¨ç½²äº‘å‡½æ•°æ‰èƒ½ç”Ÿæ•ˆã€‚

### æ–¹æ³•äºŒï¼šåœ¨æ§åˆ¶å°é…ç½®

1. è®¿é—®ï¼šhttps://console.cloud.tencent.com/tcb
2. é€‰æ‹©ç¯å¢ƒï¼š`yang0313`
3. è¿›å…¥ã€Œäº‘å‡½æ•°ã€â†’ é€‰æ‹©å‡½æ•°ï¼ˆ`upload` æˆ– `taskCheck`ï¼‰
4. è¿›å…¥ã€Œå‡½æ•°é…ç½®ã€â†’ã€Œç¯å¢ƒå˜é‡ã€
5. æ·»åŠ ç¯å¢ƒå˜é‡ï¼š
   - é”®ï¼š`RUNNINGHUB_API_KEY`
   - å€¼ï¼šæ‚¨çš„ API Key
6. ç‚¹å‡»ã€Œä¿å­˜ã€

## ä¸‰ã€åˆå§‹åŒ–æ•°æ®åº“

### 1. åˆ›å»º tasks é›†åˆ

1. è®¿é—®ï¼šhttps://console.cloud.tencent.com/tcb
2. é€‰æ‹©ç¯å¢ƒï¼š`yang0313`
3. è¿›å…¥ã€Œæ•°æ®åº“ã€â†’ã€Œåˆ›å»ºé›†åˆã€
4. é›†åˆåç§°ï¼š`tasks`
5. æƒé™è®¾ç½®ï¼š**è¯»å–å…¨éƒ¨æ•°æ®ï¼Œä¿®æ”¹æœ¬äººæ•°æ®**
6. ç‚¹å‡»ã€Œç¡®å®šã€

### 2. åˆ›å»ºç´¢å¼•

è¿›å…¥ `tasks` é›†åˆ â†’ã€Œç´¢å¼•ã€æ ‡ç­¾ï¼Œåˆ›å»ºä»¥ä¸‹ç´¢å¼•ï¼š

| ç´¢å¼•å | å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|--------|------|------|------|
| `idx_taskId` | `taskId` | å”¯ä¸€ç´¢å¼• | ä»»åŠ¡ ID å”¯ä¸€ |
| `idx_userId` | `userId` | æ™®é€šç´¢å¼• | ç”¨æˆ·æŸ¥è¯¢ |
| `idx_status` | `status` | æ™®é€šç´¢å¼• | çŠ¶æ€æŸ¥è¯¢ |
| `idx_orderId` | `orderId` | æ™®é€šç´¢å¼• | è®¢å•å…³è” |
| `idx_createdAt` | `createdAt` | é™åºç´¢å¼• | æ—¶é—´æ’åº |

**åˆ›å»ºæ­¥éª¤**ï¼š
1. ç‚¹å‡»ã€Œåˆ›å»ºç´¢å¼•ã€
2. é€‰æ‹©å­—æ®µå’Œæ’åºæ–¹å‘
3. å¦‚æœæ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå‹¾é€‰ã€Œå”¯ä¸€ã€
4. ç‚¹å‡»ã€Œç¡®å®šã€

## å››ã€é…ç½®è§†é¢‘æ¨¡æ¿

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰

1. ç¼–è¾‘ `cloud-functions/scripts/update-video-templates.js`
2. åœ¨ `VIDEO_CONFIGS` å¯¹è±¡ä¸­é…ç½®æ‚¨çš„è§†é¢‘æ¨¡æ¿ï¼š

```javascript
const VIDEO_CONFIGS = {
  'video_001': {
    runningHubWorkflowId: '1850925505116598274',
    imageNodeId: '10',
    imageFieldName: 'image',
    paymentPageId: 'payment_page_001',
  },
  'video_002': {
    runningHubWorkflowId: '1850925505116598275',
    imageNodeId: '10',
    imageFieldName: 'image',
    paymentPageId: 'payment_page_002',
  },
};
```

3. è¿è¡Œè„šæœ¬ï¼š

```bash
cd cloud-functions
node scripts/update-video-templates.js
```

### æ–¹æ³•äºŒï¼šåœ¨æ§åˆ¶å°æ‰‹åŠ¨é…ç½®

1. è®¿é—®æ•°æ®åº“æ§åˆ¶å°
2. è¿›å…¥ `videos` é›†åˆ
3. æ‰¾åˆ°è¦é…ç½®çš„è§†é¢‘è®°å½•
4. ç‚¹å‡»ã€Œç¼–è¾‘ã€ï¼Œæ·»åŠ ä»¥ä¸‹å­—æ®µï¼š

```json
{
  "runningHubWorkflowId": "1850925505116598274",
  "imageNodeId": "10",
  "imageFieldName": "image",
  "paymentPageId": "payment_page_001"
}
```

5. ç‚¹å‡»ã€Œä¿å­˜ã€

### è§†é¢‘æ¨¡æ¿å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|------|--------|
| `runningHubWorkflowId` | String | âœ… | RunningHub å·¥ä½œæµ ID | - |
| `imageNodeId` | String | âŒ | å›¾ç‰‡è¾“å…¥èŠ‚ç‚¹ ID | `10` |
| `imageFieldName` | String | âŒ | å›¾ç‰‡å­—æ®µå | `image` |
| `paymentPageId` | String | âŒ | æ”¯ä»˜é¡µé¢ ID | - |

## äº”ã€éƒ¨ç½²äº‘å‡½æ•°

### 1. æ„å»ºé¡¹ç›®

```bash
cd cloud-functions
node build.js
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    æ„å»ºäº‘å‡½æ•°                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ å¤åˆ¶ shared ç›®å½•åˆ°å„å‡½æ•°...

âœ… auth/shared - å·²å¤åˆ¶
âœ… user/shared - å·²å¤åˆ¶
...
âœ… upload/shared - å·²å¤åˆ¶
âœ… taskCheck/shared - å·²å¤åˆ¶

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    æ„å»ºå®Œæˆï¼                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 2. éƒ¨ç½² upload å‡½æ•°

```bash
tcb fn deploy upload --force
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
CloudBase CLI 2.11.2
âˆš [upload] äº‘å‡½æ•°éƒ¨ç½²æˆåŠŸï¼
```

### 3. éƒ¨ç½² taskCheck å‡½æ•°

```bash
tcb fn deploy taskCheck --force
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
CloudBase CLI 2.11.2
âˆš [taskCheck] äº‘å‡½æ•°éƒ¨ç½²æˆåŠŸï¼
```

### 4. éªŒè¯éƒ¨ç½²

æ£€æŸ¥å‡½æ•°æ—¥å¿—ï¼Œç¡®è®¤æ²¡æœ‰é”™è¯¯ï¼š

```bash
# æŸ¥çœ‹ upload å‡½æ•°æ—¥å¿—
tcb fn log upload --limit 5

# æŸ¥çœ‹ taskCheck å‡½æ•°æ—¥å¿—
tcb fn log taskCheck --limit 5
```

## å…­ã€æµ‹è¯•

### 1. æµ‹è¯• API Key

åˆ›å»ºä¸€ä¸ªæµ‹è¯•è„šæœ¬ `test-runninghub.js`ï¼š

```javascript
const { runningHubService } = require('./functions/shared/runninghub');

async function test() {
  try {
    // è®¾ç½® API Keyï¼ˆè¯·æ›¿æ¢ä¸ºæ‚¨çš„å®é™… API Keyï¼‰
    runningHubService.setApiKey('YOUR_API_KEY');
    
    // æµ‹è¯•è·å–è´¦æˆ·ä¿¡æ¯
    const account = await runningHubService.getAccountInfo();
    console.log('âœ… API Key æœ‰æ•ˆ');
    console.log('è´¦æˆ·ä¿¡æ¯:', JSON.stringify(account, null, 2));
  } catch (err) {
    console.error('âŒ API Key æ— æ•ˆ:', err.message);
  }
}

test();
```

è¿è¡Œï¼š

```bash
cd cloud-functions
node test-runninghub.js
```

### 2. æµ‹è¯•åˆ›å»ºä»»åŠ¡

ä½¿ç”¨ Postman æˆ– curl æµ‹è¯•ï¼š

```bash
curl -X POST https://yang0313-7g4dqwd46c63d876-1318057968.ap-shanghai.app.tcloudbase.com/api/upload/create-task \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "orderId": "order_xxx",
    "videoId": "video_xxx",
    "inputPhotoUrl": "https://cos.xxx/photo.jpg"
  }'
```

### 3. æµ‹è¯•æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```bash
curl -X POST https://yang0313-7g4dqwd46c63d876-1318057968.ap-shanghai.app.tcloudbase.com/api/upload/task-status \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "taskId": "task_xxx"
  }'
```

## ä¸ƒã€éªŒè¯å®Œæ•´æµç¨‹

### 1. æ£€æŸ¥å®šæ—¶ä»»åŠ¡

1. ç­‰å¾… 1-2 åˆ†é’Ÿ
2. æŸ¥çœ‹ `taskCheck` å‡½æ•°æ—¥å¿—ï¼Œç¡®è®¤å®šæ—¶ä»»åŠ¡æ­£å¸¸è¿è¡Œ
3. æ£€æŸ¥æ˜¯å¦æœ‰ä»»åŠ¡è¢«å¤„ç†

### 2. æ£€æŸ¥ä»»åŠ¡çŠ¶æ€

1. åˆ›å»ºä¸€ä¸ªæµ‹è¯•ä»»åŠ¡
2. ç­‰å¾…å‡ åˆ†é’Ÿ
3. æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ï¼Œç¡®è®¤çŠ¶æ€æ­£å¸¸æ›´æ–°

### 3. æ£€æŸ¥æ•°æ®åº“

1. è¿›å…¥ `tasks` é›†åˆ
2. æŸ¥çœ‹æ˜¯å¦æœ‰æ–°ä»»åŠ¡è®°å½•
3. ç¡®è®¤ä»»åŠ¡çŠ¶æ€å­—æ®µæ­£ç¡®æ›´æ–°

## å…«ã€å¸¸è§é—®é¢˜

### Q: API Key æ— æ•ˆ

**A:** æ£€æŸ¥ï¼š
1. API Key æ˜¯å¦æ­£ç¡®å¤åˆ¶ï¼ˆ32 ä½ï¼‰
2. è´¦å·æ˜¯å¦ä¸ºåŸºç¡€ç‰ˆåŠä»¥ä¸Šä¼šå‘˜
3. è´¦å·æ˜¯å¦æœ‰è¶³å¤Ÿçš„ RH å¸
4. ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®é…ç½®

### Q: ä»»åŠ¡åˆ›å»ºå¤±è´¥

**A:** æ£€æŸ¥ï¼š
1. è§†é¢‘æ¨¡æ¿æ˜¯å¦é…ç½®äº† `runningHubWorkflowId`
2. å·¥ä½œæµæ˜¯å¦åœ¨ RunningHub æ‰‹åŠ¨è¿è¡ŒæˆåŠŸè¿‡
3. èŠ‚ç‚¹ ID å’Œå­—æ®µåæ˜¯å¦æ­£ç¡®
4. è®¢å•æ˜¯å¦å·²æ”¯ä»˜

### Q: ä»»åŠ¡ä¸€ç›´å¤„äº pending çŠ¶æ€

**A:** æ£€æŸ¥ï¼š
1. `taskCheck` å‡½æ•°æ˜¯å¦æ­£å¸¸éƒ¨ç½²
2. å®šæ—¶è§¦å‘å™¨æ˜¯å¦é…ç½®ï¼ˆæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼‰
3. æŸ¥çœ‹å‡½æ•°æ—¥å¿—æ’æŸ¥é”™è¯¯
4. ç¡®è®¤ `RUNNINGHUB_API_KEY` ç¯å¢ƒå˜é‡å·²è®¾ç½®

### Q: ä¸Šä¼ èµ„æºå¤±è´¥

**A:** æ£€æŸ¥ï¼š
1. æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡ 30MB
2. æ–‡ä»¶æ ¼å¼æ˜¯å¦æ”¯æŒï¼ˆJPG, PNG, JPEG, WEBPï¼‰
3. COS æ–‡ä»¶ URL æ˜¯å¦å¯è®¿é—®
4. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### Q: RunningHub ä»»åŠ¡å¤±è´¥

**A:** æ£€æŸ¥ï¼š
1. åœ¨ RunningHub ç½‘é¡µç«¯æ‰“å¼€ä»»åŠ¡åˆ—è¡¨
2. æ‰¾åˆ°å¯¹åº”çš„ taskId
3. ç‚¹å‡»ã€Œå°çº¢ç‚¹ã€æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
4. æ£€æŸ¥å·¥ä½œæµé…ç½®æ˜¯å¦æ­£ç¡®

## ä¹ã€ç›‘æ§å’Œç»´æŠ¤

### 1. ç›‘æ§ä»»åŠ¡çŠ¶æ€

å®šæœŸæ£€æŸ¥ï¼š
- ä»»åŠ¡æˆåŠŸç‡
- å¹³å‡å¤„ç†æ—¶é—´
- å¤±è´¥ä»»åŠ¡æ•°é‡
- è¶…æ—¶ä»»åŠ¡æ•°é‡

### 2. æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹ upload å‡½æ•°æ—¥å¿—
tcb fn log upload --limit 50

# æŸ¥çœ‹ taskCheck å‡½æ•°æ—¥å¿—
tcb fn log taskCheck --limit 50
```

### 3. å¤„ç†å¼‚å¸¸ä»»åŠ¡

1. æŸ¥çœ‹å¤±è´¥ä»»åŠ¡
2. åˆ†æå¤±è´¥åŸå› 
3. æ‰‹åŠ¨é‡è¯•æˆ–é€€æ¬¾

## åã€ä¸‹ä¸€æ­¥

å®Œæˆéƒ¨ç½²åï¼Œç»§ç»­ï¼š

1. âœ… **æµ‹è¯•å®Œæ•´æµç¨‹** - ä»è´­ä¹°åˆ°è·å–è§†é¢‘
2. âœ… **é…ç½®ç›‘æ§å‘Šè­¦** - è®¾ç½®ä»»åŠ¡å¤±è´¥å‘Šè­¦
3. âœ… **ä¼˜åŒ–æ€§èƒ½** - æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´è¶…æ—¶æ—¶é—´
4. âœ… **å‰ç«¯å¯¹æ¥** - å¼€å‘å‰ç«¯é¡µé¢è°ƒç”¨ API

---

**æ›´æ–°æ—¶é—´**: 2025å¹´12æœˆ
**çŠ¶æ€**: âœ… RunningHub éƒ¨ç½²æŒ‡å—å·²å°±ç»ª

